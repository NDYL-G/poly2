(function(){const s=document.getElementById('status'),c=document.getElementById('clock'),iEl=document.getElementById('idx'),lEl=document.getElementById('len'),src=document.getElementById('src'),frame=document.getElementById('stage');const LSP='vvx_playlist_v1',LSS='vvx_settings_v1';const dft={dwellSeconds:10,playlistUrl:'data/playlist.json'};function tick(){c.textContent=new Date().toLocaleString()}setInterval(tick,1000);tick();function setS(t){s.textContent=t}async function j(u){const r=await fetch(u,{cache:'no-store'});if(!r.ok)throw new Error('HTTP '+r.status);return r.json()}function gS(){try{const r=localStorage.getItem(LSS);if(r)return JSON.parse(r)}catch{}return{}}function sv(pl){try{localStorage.setItem(LSP,JSON.stringify(pl))}catch{}}async function lp(){try{const r=localStorage.getItem(LSP);if(r)return JSON.parse(r)}catch{}const st=Object.assign({},dft,gS());const data=await j(st.playlistUrl);sv(data);return data}async function run(){setS('Loading playlistâ€¦');let pl=await lp();if(!Array.isArray(pl)||!pl.length){setS('Empty playlist');return}lEl.textContent=String(pl.length);let k=0;const dwell=Math.max(3,Number(gS().dwellSeconds)||10)*1000;async function nxt(){const it=pl[k%pl.length];k++;iEl.textContent=String(((k-1)%pl.length)+1);const url=it.url||it;src.textContent=url;setS('');try{frame.src=url}catch(e){location.href=url;return}setTimeout(nxt,dwell)}nxt()}run().catch(e=>setS('Error: '+(e.message||e)))} )();